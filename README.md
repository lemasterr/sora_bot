# sora_bot

Инструменты для автоматизации сценариев Sora Suite: автогенерация контента,
загрузка и обработка материалов. Приложение включает десктопный интерфейс на
PyQt6 и набор воркеров, которые запускаются напрямую из GUI.

## Установка зависимостей

```bash
python -m venv .venv
source .venv/bin/activate  # или .venv\Scripts\activate в Windows
python -m pip install --upgrade pip
python -m pip install -r sora_suite/requirements.txt
```

> **Важно:** для генерации изображений используется библиотека
> `google-genai==1.45.0`. Эта версия доступна для Python 3.9+ и корректно
> устанавливается на macOS, Linux и Windows.

## Настройка Google AI Studio

1. Получите API-ключ в [Google AI Studio](https://aistudio.google.com/).
2. Запустите Sora Suite и откройте вкладку **Настройки → Генерация картинок**.
3. В блоке «Google AI Studio — генерация изображений» включите опцию и заполните:
   - API-ключ;
   - модель (`models/imagen-4.0-generate-001` по умолчанию);
   - параметры генерации (соотношение сторон, размер, MIME-тип, число картинок,
     лимит запросов и директорию для сохранения).
4. Уточните, нужно ли прикреплять сгенерированные изображения к заявке в Sora —
   для этого предусмотрен чекбокс «Прикреплять сгенерированные изображения к
   заявке в Sora».
5. Сохраните настройки — они автоматически попадут в окружение воркера
   `workers/autogen/main.py`.

Промпты можно описывать как обычным текстом по строкам, так и в JSON-формате,
передавая поля `prompt`, `image_prompts`, `attachments` и `number_of_images`.
Чтобы привязать текстовую заявку к конкретному изображению, используйте поле
`video_prompt` (доступно как в `prompts.txt`, так и в `image_prompts.txt`). Если
чекбокс прикрепления выключен, изображения всё равно сохраняются в
`generated_images/`, но не подгружаются к заявке.

## Генерация картинок по шагам

1. На вкладке «Промпты картинок» отредактируйте `image_prompts.txt`. Каждая
   строка обрабатывается по порядку, поэтому можно задать десяток разных
   промптов — воркер последовательно вызовет Google AI Studio для каждого из них.
   JSON-формат позволяет указать несколько вариантов (`prompts`), количество
   изображений (`count`) и отдельный текст `video_prompt`, который позже будет
   отправлен в Sora.
2. Нажмите кнопку **«Генерация картинок (Google)»**. Теперь она запускает режим
   `GENAI_IMAGES_ONLY=1`: воркер обращается только к API Google AI Studio,
   сохраняет результаты в папке `generated_images/` и фиксирует их в
   `generated_images/manifest.json` без каких-либо действий в интерфейсе Sora.
   Так проще просмотреть и отобрать удачные изображения до подачи заявок.
3. После проверки запустите **«Сохранить и запустить автоген (видео)»**.
   Воркер прочитает `manifest.json`, сопоставит строки `image_prompts.txt` с
   очередью `prompts.txt`, автоматически подставит `video_prompt` и прикрепит
   уже готовые изображения (если включён соответствующий чекбокс в настройках).
   При отключенном чекбоксе `attach_to_sora` воркер просто повторно использует
   текст без медиа.

## Кнопки автогена

На вкладке «Промпы» доступны два варианта запуска:

- **«Сохранить и запустить автоген (видео)»** — классический сценарий отправки
  промптов в Sora без обязательной генерации изображений (используется, например,
  для видео-генерации). Если до этого был запущен режим генерации картинок, в
  очередь попадут уже проверенные файлы из `generated_images/`.
- **«Сохранить и запустить автоген (картинки)»** — теперь запускает только
  генерацию изображений через Google AI Studio (без открытия Sora). Перед
  стартом приложение проверяет наличие API-ключа и включает `GENAI_ENABLED=1`,
  чтобы сохранить результаты и обновить manifest для последующего шага.

Обе кнопки сохраняют актуальный файл промптов, при необходимости очищают
`submitted.log` и запускают воркер в фоне, сохраняя отзывчивость интерфейса.
