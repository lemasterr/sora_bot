# Sora Suite — контрольная панель пайплайна

Sora Suite — настольное приложение на PyQt6 для полного цикла контента: генерация промптов и изображений, скачивание драфтов из Sora, блюр/ренейм/склейка, загрузка на YouTube и TikTok и сервисные операции. Интерфейс разделён на крупные секции и подпункты, поэтому быстрые действия находятся рядом с нужными данными, а развернутые настройки доступны отдельно.

## Содержание
- [Установка и первый запуск](#установка-и-первый-запуск)
- [Запуск Chrome с CDP](#запуск-chrome-с-cdp)
- [Обзор интерфейса](#обзор-интерфейса)
  - [Обзор](#обзор)
  - [Контент](#контент)
  - [Автопостинг](#автопостинг)
  - [Настройки](#настройки)
- [Рабочие каталоги и быстрый доступ](#рабочие-каталоги-и-быстрый-доступ)
- [Генерация картинок через Google AI Studio](#генерация-картинок-через-google-ai-studio)
- [FFmpeg: таблица параметров](#ffmpeg-таблица-параметров)
- [История событий и статистика](#история-событий-и-статистика)
- [Оптимизации и производительность](#оптимизации-и-производительность)
- [FAQ и подсказки](#faq-и-подсказки)

## Установка и первый запуск
### Быстрый скрипт
```bash
python scripts/bootstrap.py
```
Скрипт создаёт виртуальное окружение, ставит зависимости из `sora_suite/requirements.txt` и скачивает Chromium для Playwright.

### Ручная установка
```bash
python -m venv .venv
# Windows: .venv\Scripts\activate
# macOS/Linux: source .venv/bin/activate
pip install -r sora_suite/requirements.txt
python -m playwright install chromium
```

### Системные зависимости
- **FFmpeg** в `PATH` (`brew install ffmpeg`, `sudo apt install ffmpeg`, либо бинарь с gyan.dev для Windows).
- **Playwright** требует `libnss3`, `libxss1`, `fonts-liberation` (Ubuntu: `sudo apt install libnss3 libxss1 fonts-liberation`).
- **OpenCV** ставится автоматически.

## Запуск Chrome с CDP
Автоген и загрузчики подключаются к открытому окну Chrome/Chromium через DevTools Protocol. Нужно запустить браузер с удалённым портом и указать этот порт в настройках (`Настройки → Chrome → CDP порт`).

Пример для macOS:
```bash
/Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome \
  --remote-debugging-port=9222 \
  --user-data-dir=/tmp/chrome-sora
```
Windows:
```powershell
"C:\Program Files\Google\Chrome\Application\chrome.exe" `
  --remote-debugging-port=9222 `
  --user-data-dir=%TEMP%\chrome-sora
```
Любой свободный порт (1024–65535) подойдёт; главное, чтобы значение совпадало в настройках приложения. При запуске браузера проверьте `http://localhost:<порт>/json/version` — в ответ должен прийти JSON с полем `webSocketDebuggerUrl`.

## Обзор интерфейса
Главное окно разделено на левую панель с текущим событием/историей и правый блок с вкладками. Верхняя панель содержит быстрые кнопки и выбор профиля Chrome.

### Обзор
Раздел «Обзор» содержит три подпункта:
- **Сценарии** — основной пульт. Здесь переключаются этапы пайплайна, запускается Chrome, открываются ключевые каталоги (RAW, BLURRED, MERGED, Generated Images) и отображается расширенная статистика. Стрип статистики включает карточки RAW/BLURRED/MERGED/YouTube/TikTok и новую карточку **IMAGES** с числом сгенерированных картинок и их размером. Для каждого блока подсказка показывает размер папки и краткое имя каталога.
- **История** — события с цветовой кодировкой, отметкой времени, иконками, строкой фильтра по тексту/тегу и кнопкой экспорта в текстовый файл.
- **Ошибки** — справочник типовых проблем и способов решения.

В верхней панели добавлен выпадающий список профилей Chrome (быстрая активация) и кнопка открытия папки с сгенерированными изображениями.

### Контент
Секция «Контент» объединяет управление текстовыми материалами:
- **Промпты Sora** — профили Chrome, редактор промптов, история использованных строк.
- **Промпты картинок** — отдельный редактор `image_prompts.txt`, поддержка JSON-описаний (несколько картинок, `video_prompt`, `count`). Кнопка запуска Google AI Studio и мгновенное открытие каталога `generated_images/`.
- **Названия** — список заголовков для переименования скачанных роликов.

### Автопостинг
Подраздел с двумя вкладками:
- **YouTube** — управление каналами, папкой загрузки, расписанием, очередью и ручным запуском.
- **TikTok** — профили API, папка, расписание, GitHub Actions. Отступы в таблицах уменьшены для более плотного отображения.

### Настройки
Подробные настройки расположены в знакомых вкладках (Каталоги, UI, Chrome, FFmpeg, YouTube, TikTok, Telegram, Генерация картинок, Обслуживание, Документация). В «Каталогах» добавлены отдельные поля и кнопки открытия/обзора для всех рабочих путей: `downloads`, `blurred`, `merged`, источники для BLUR/MERGE, `generated_images`, `history.jsonl`, `titles.txt`. Все изменения синхронизируются между каталожным и профильным разделом Google AI.

## Рабочие каталоги и быстрый доступ
Каждый путь в разделе «Каталоги» сопровождается двумя кнопками:
- `…` — выбрать папку/файл в диалоге.
- `↗` — открыть выбранный путь в проводнике (или создастся автоматически, если каталога ещё нет).

Дополнительно в верхней панели и в задачах доступны кнопки быстрого открытия всех ключевых директорий.

## Генерация картинок через Google AI Studio
- Генерация запускается отдельной кнопкой («Генерация картинок (Google)») и может работать без обращения к Sora.
- Полученные файлы переименовываются последовательно (`1.jpg`, `2.jpg`, …), записываются в `generated_images/manifest.json` и отображаются в карточке статистики.
- В настройках Google AI можно указать модель, Aspect Ratio, Image Size, MIME-тип, лимиты и флаг «Прикреплять к заявке Sora». Папка вывода синхронизирована между вкладками «Каталоги» и «Генерация картинок».
- При запуске видео-автогена включённая опция прикрепления добавляет изображения через новый «+» на странице Sora и подставляет `video_prompt` из манифеста. Если опция выключена, воркер сохранит картинки, но отправит в Sora только текстовые промпты.

## FFmpeg: таблица параметров
| Параметр | Значение по умолчанию | Где менять | Назначение | Примечания |
| --- | --- | --- | --- | --- |
| `binary` | `ffmpeg` | Настройки → FFmpeg | Путь к исполняемому FFmpeg | Укажите абсолютный путь, если бинарь вне `PATH`.
| `vcodec` | `auto_hw` | Настройки → FFmpeg | Видеокодек для блюра/рендера | `auto_hw` выбирает доступный аппаратный кодек; при блюре `copy` заменяется на `libx264`.
| `crf` | `18` | Настройки → FFmpeg | Качество `libx264` (0–51) | 18–20 — баланс качества и размера.
| `preset` | `veryfast` | Настройки → FFmpeg | Скорость кодирования | Чем медленнее preset, тем выше качество и нагрузка.
| `format` | `mp4` | Настройки → FFmpeg | Контейнер итоговых файлов | TikTok/YouTube предпочитают `mp4`.
| `copy_audio` | `True` | Настройки → FFmpeg | Копировать аудио без перекодирования | При несовместимом аудио приложение предложит перекодировку в AAC.
| `blur_threads` | `2` | Настройки → FFmpeg | Количество параллельных процессов блюра | Подберите под количество ядер/нагрузку.
| `post_chain` | `boxblur=1:1,noise=alls=2:allf=t,unsharp=3:3:0.5:3:3:0.0` | Настройки → FFmpeg | Дополнительные фильтры | Выполняются после применения масок блюра.
| `presets.*.zones` | См. примеры | Настройки → FFmpeg | Координаты зон блюра | Таблица редактируется в UI, предпросмотр доступен через OpenCV.

## История событий и статистика
- История показывает время события (`HH:MM:SS`), цветовую метку и иконку статуса. Сверху доступны чекбокс «Показывать», строка фильтра и кнопка экспорта в `activity_log.txt`.
- Карточка «Сейчас» синхронизирована с фильтром и автоматически очищается при очистке истории.
- Статистика подсчитывает файлы в ключевых каталогах и отображает размеры (`RAW`, `BLURRED`, `MERGED`, очереди YouTube/TikTok и количество изображений). Подсказки показывают размер и название папки.

## Оптимизации и производительность
- Подсчёт статистики кеширует результаты на основе времени изменения каталогов, что ускоряет обновление карточек.
- README в настройках загружается лениво — только при переходе на вкладку «Документация» или по кнопке «Обновить», что сокращает время старта.
- Поля путей автоматически синхронизируются между разделами (каталоги ↔ генерация изображений), а кнопки открытия/обзора работают даже на чистой установке.

## FAQ и подсказки
- **Где лежат рабочие каталоги?** По умолчанию все папки (`downloads`, `blurred`, `merged`, `generated_images`, `uploaded`, `uploaded_tiktok`) создаются рядом с `sora_suite/app.py`. Настройки позволяют перенести их в любое место.
- **Как быстро переключить профиль Chrome?** Используйте выпадающий список в верхней панели. Активный профиль сохраняется в конфиге и отображается в настройках.
- **Можно ли экспортировать историю?** Да, на вкладке «История» нажмите «Экспорт» и сохраните лог в текстовый файл.
- **Как понять, что браузер доступен для автогена?** Если порт открыт, в истории появится сообщение «Chrome ✓ порт <номер>»; при ошибке подключение повторится, а в истории появится предупреждение.
- **Что делать с конфликтами путей?** Каждая строка в разделе «Каталоги» показывает текущий путь. Нажмите `↗`, чтобы убедиться, что каталог существует, и `…`, чтобы переназначить его.

Sora Suite продолжает развиваться: если нужна дополнительная интеграция или автоматизация, добавьте issue/PR в репозитории `sora_bot`.
