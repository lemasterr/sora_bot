# Sora Suite — Полированный комплект

Готовый переносимый проект для:
- автоподачи промптов в Sora,
- автоскачки видео драфтов,
- блюра зон (FFmpeg) и склейки по готовым пресетам,
- отложенного постинга на YouTube для нескольких каналов,
- автоматической очистки рабочих папок по заданным срокам хранения,
- с GUI на PyQt6 и системными уведомлениями (tray).

## Установка (один раз)

```bash
python -m venv .venv && . .venv/bin/activate   # Windows: .venv\Scripts\activate
pip install -r requirements.txt
python -m playwright install chromium
```

**FFmpeg**: установите в систему (`ffmpeg` в PATH).

## Запуск GUI

```bash
python app.py
```

В GUI:
- вкладка **Задачи** — теперь разбита на подпункты: «Пайплайн» с галочками и запуском, отдельные вкладки для скачки, переименования и склейки;
- вкладка **Промпты** — редактируйте `workers/autogen/prompts.txt` (1 строка = 1 промпт);
- вкладка **Настройки** — теперь разбита на подстраницы (Каталоги, Chrome, FFmpeg, YouTube, Telegram, Автоген, Документация) с автосохранением и кнопкой «Применить»;
- вкладка **Документация** внутри настроек показывает `README.md` прямо в приложении, есть кнопка «Обновить»;
- вкладка **YouTube** — управление каналами, выбор папки с клипами, планирование публикаций пакетами (интервал и ограничение на количество);
- системные уведомления сообщают о старте/успехе/ошибке каждого шага.

На левой панели теперь есть карточка «Сейчас» с текущим шагом пайплайна и компактной сводкой, а подробный лог можно по желанию спрятать переключателем «Показывать историю». Так интерфейс остаётся лёгким для повседневной работы, но подробности всегда доступны одной галочкой.

## Папки и автосинхронизация

На странице **Настройки → Каталоги** поля `Источник BLUR`, `Источник MERGE` и «Папка с клипами» для YouTube автоматически следуют за основными папками (`RAW`, `BLURRED`, `MERGED`). Как только вы меняете путь скачивания, соответствующие источники обновляются сами, поэтому блюр и склейка всегда берут файлы из актуальных директорий. Если нужна своя структура, просто впишите кастомный путь — автосвязь отключится до тех пор, пока снова не введёте значение, совпадающее с основным.

## Обслуживание каталогов

Во вкладке **Настройки → Обслуживание** можно задать срок хранения для папок RAW, BLURRED и MERGED. По умолчанию оставляем 7/14/30 дней соответственно, но можно поставить 0, если автоочистка не нужна. Кнопка «Очистить сейчас» мгновенно удаляет устаревшие файлы (и пустые подпапки), «Размеры папок» покажет объём рабочих директорий в человеко-читаемом виде, а переключатель «Очищать автоматически при запуске» запускает ту же процедуру при старте приложения. Все действия отображаются в панели событий, чтобы было понятно, что именно удалено.

## Конфиги и файлы

- `app_config.yaml` — главный конфиг GUI.
- `workers/autogen/config.yaml` — параметры автогена.
- `workers/autogen/selectors.yaml` — селекторы DOM (textarea/кнопка/тосты/очередь).
- `workers/downloader/download_config.yaml` — скачка и URL-кандидаты.
- `workers/autogen/prompts.txt` — текстовые промпты.
- `titles.txt` — имена для переименования скачанных файлов.
- `workers/uploader/upload_queue.py` — загрузка на YouTube (YouTube Data API v3).

## YouTube: отложенный постинг

1. Создайте OAuth-клиент в [Google Cloud Console](https://console.cloud.google.com/) (тип «Desktop») и скачайте `client_secret.json`.
2. Во вкладке **YouTube** добавьте канал, указав путь к `client_secret.json`, путь для `credentials.json` (можно оставить пустым — сохранится рядом) и приватность по умолчанию.
3. Выберите активный канал. Во вкладке **YouTube** задайте папку с клипами (по умолчанию `merged`), включите отложенную публикацию и установите стартовую дату/время — значение сохраняется между запусками. Интервал между роликами задаётся в минутах, поэтому пачка из 10 клипов с шагом 60 минут выйдет «лесенкой» (первый через час, второй через два и т.д.).
4. При первом запуске появится консольное окно с OAuth-кодом — авторизуйтесь от имени нужного YouTube-аккаунта. Токен сохраняется в `credentials.json`, поэтому разные пользователи/каналы могут сосуществовать (по одному файлу на канал).
5. После удачной загрузки файл и метаданные перемещаются в архив (`uploaded/` по умолчанию) — путь и факт перемещения виден в информационной панели. Для индивидуальных описаний положите рядом с роликом `*.json` или `*.yaml` с ключами `title`, `description`, `tags`, `publishAt`.

> **Windows/macOS/Linux**: приложение автоматически подставляет корректный путь к Chrome и создаёт рабочие каталоги, поэтому портирование между системами не требует ручного редактирования путей.

## Telegram (опционально)
Перейдите в **Настройки → Telegram** и заполните `Bot token` и `Chat ID`. Здесь же можно включить/отключить уведомления и отправить тестовое сообщение. Статус отражается в панели событий, а включённый бот сообщает об окончании каждого шага сценария.

## Сборка дистрибутивов

### Windows: EXE через PyInstaller

```bash
python -m pip install pyinstaller
pyinstaller --noconfirm --clean --windowed --name "SoraSuite" --add-data "sora_suite/app_config.yaml;sora_suite" sora_suite/app.py
```

Готовый EXE появится в `dist/SoraSuite/SoraSuite.exe`. Папку `dist/SoraSuite` можно архивировать или упаковать с помощью `Inno Setup`, если нужен инсталлятор.

### macOS: приложение и DMG

```bash
python -m pip install pyinstaller create-dmg
pyinstaller --noconfirm --clean --windowed --name "SoraSuite" --add-data "sora_suite/app_config.yaml:sora_suite" sora_suite/app.py
```

После сборки в `dist/SoraSuite.app` создайте DMG:

```bash
create-dmg \
  --overwrite \
  --volname "Sora Suite" \
  --app-drop-link 400 200 \
  "SoraSuite.dmg" \
  "dist/SoraSuite.app"
```

Полученный `SoraSuite.dmg` можно распространять. На macOS Monterey и новее потребуется подписать и/или нотариально заверить приложение, если планируется установка без предупреждений Gatekeeper.

